(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[875],{63:(e,t,r)=>{"use strict";var s=r(7260);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSelectedLayoutSegments")&&r.d(t,{useSelectedLayoutSegments:function(){return s.useSelectedLayoutSegments}})},1235:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var s=r(5155),o=r(2115),a=r(63);async function n(e){let t;try{t=new URL(e)}catch(e){throw Error("Invalid URL format. Please provide a valid URL.")}if(!["http:","https:"].includes(t.protocol))throw Error("URL must use http:// or https:// protocol.");let r=new AbortController,s=setTimeout(()=>r.abort(),3e4);try{let o=await fetch(e,{method:"GET",signal:r.signal,headers:{"User-Agent":"SBWC-ChatBot/1.0"}});if(clearTimeout(s),!o.ok)throw Error("Failed to fetch document: ".concat(o.status," ").concat(o.statusText));let a=o.headers.get("content-type")||"application/octet-stream",n=a.includes("text/plain"),i=a.includes("application/pdf"),d=t.pathname.toLowerCase().endsWith(".txt"),l=t.pathname.toLowerCase().endsWith(".pdf");if(!n&&!i&&!d&&!l)throw Error("URL must point to a .txt or .pdf file. Detected content type: "+a);let c=o.headers.get("content-length");if(c&&parseInt(c,10)>0xa00000)throw Error("Document from URL exceeds 10MB limit (".concat(Math.round(parseInt(c,10)/1024/1024),"MB)"));let u=t.pathname.split("/").pop()||"document",m=o.headers.get("content-disposition");if(m){let e=m.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(u=e[1].replace(/['"]/g,""))}u.endsWith(".txt")||u.endsWith(".pdf")||(i||l?u+=".pdf":u+=".txt");let h=await o.blob();if(h.size>0xa00000)throw Error("Document from URL exceeds 10MB limit (".concat(Math.round(h.size/1024/1024),"MB)"));let p=a;return u.endsWith(".pdf")?p="application/pdf":u.endsWith(".txt")&&(p="text/plain"),{file:new File([h],u,{type:p}),name:u,size:h.size,type:p}}catch(e){if(clearTimeout(s),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout. The URL took too long to respond (>30 seconds).");if(e instanceof TypeError)throw Error("Network error. Unable to reach the URL. Please check the URL and try again.");throw e}}function i(){let e=(0,a.useRouter)(),[t,r]=(0,o.useState)("file"),[i,d]=(0,o.useState)(""),[l,c]=(0,o.useState)(!1),[u,m]=(0,o.useState)({status:"idle",message:"",progress:0}),h=(0,o.useCallback)(async t=>{try{m({status:"uploading",message:"Uploading file...",progress:30});let r=["text/plain","application/pdf"].includes(t.type),s=[".txt",".pdf"].some(e=>t.name.toLowerCase().endsWith(e));if(!r&&!s)throw Error("Invalid file type. Only .txt and .pdf files are supported.");if(t.size>0xa00000)throw Error("File too large. Maximum size is 10MB.");if(0===t.size)throw Error("File is empty.");let o=new FormData;o.append("file",t);let a=await fetch("/api/documents",{method:"POST",body:o}),n=await a.json();if(!a.ok)throw Error(n.message||"Upload failed");m({status:"processing",message:"Processing document...",progress:70}),await new Promise(e=>setTimeout(e,1e3)),m({status:"success",message:"Document uploaded successfully!",progress:100}),e.refresh(),setTimeout(()=>{m({status:"idle",message:"",progress:0})},2e3)}catch(e){m({status:"error",message:e instanceof Error?e.message:"Upload failed",progress:0}),setTimeout(()=>{m({status:"idle",message:"",progress:0})},5e3)}},[e]),p=async()=>{try{let e=function(e){let t;if(!e||0===e.trim().length)return{valid:!1,error:"URL cannot be empty."};try{t=new URL(e)}catch(e){return{valid:!1,error:"Invalid URL format."}}if(!["http:","https:"].includes(t.protocol))return{valid:!1,error:"URL must use http:// or https:// protocol."};let r=t.pathname.toLowerCase();return r.endsWith(".txt")||r.endsWith(".pdf")?{valid:!0}:{valid:!1,error:"URL should point to a .txt or .pdf file. If the URL is correct, you can still try fetching it."}}(i);if(!e.valid){m({status:"error",message:e.error||"Invalid URL",progress:0}),setTimeout(()=>{m({status:"idle",message:"",progress:0})},5e3);return}m({status:"uploading",message:"Fetching document from URL...",progress:20});let{file:t}=await n(i);m({status:"uploading",message:"Uploading document...",progress:50}),await h(t),d("")}catch(e){m({status:"error",message:e instanceof Error?e.message:"Failed to fetch document from URL",progress:0}),setTimeout(()=>{m({status:"idle",message:"",progress:0})},5e3)}};return(0,s.jsxs)("div",{className:"bg-card border border-border rounded-lg p-6 shadow-sm",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Upload Documents"}),(0,s.jsxs)("div",{className:"flex gap-2 mb-6 border-b border-border",children:[(0,s.jsx)("button",{onClick:()=>r("file"),className:"px-4 py-2 font-medium transition-colors ".concat("file"===t?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"),children:"File Upload"}),(0,s.jsx)("button",{onClick:()=>r("url"),className:"px-4 py-2 font-medium transition-colors ".concat("url"===t?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"),children:"URL Input"})]}),"file"===t&&(0,s.jsx)("div",{children:(0,s.jsx)("div",{onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),c(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),c(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),c(!1);let t=e.dataTransfer.files;t&&t.length>0&&h(t[0])},className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(l?"border-primary bg-primary/5":"border-border hover:border-primary/50"," ").concat("uploading"===u.status||"processing"===u.status?"opacity-50 pointer-events-none":""),children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("svg",{className:"w-12 h-12 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-lg font-medium mb-1",children:"Drag files here or click to browse"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Supported: .txt, .pdf (max 10MB)"})]}),(0,s.jsxs)("label",{className:"cursor-pointer",children:[(0,s.jsx)("input",{type:"file",accept:".txt,.pdf",onChange:e=>{let t=e.target.files;t&&t.length>0&&h(t[0])},className:"hidden",disabled:"uploading"===u.status||"processing"===u.status}),(0,s.jsx)("span",{className:"inline-block px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:"Browse Files"})]})]})})}),"url"===t&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"url-input",className:"block text-sm font-medium mb-2",children:"Enter document URL"}),(0,s.jsx)("input",{id:"url-input",type:"url",value:i,onChange:e=>d(e.target.value),placeholder:"https://example.com/document.pdf",className:"w-full px-4 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-background",disabled:"uploading"===u.status||"processing"===u.status}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Must be a direct link to a .txt or .pdf file"})]}),(0,s.jsx)("button",{onClick:p,disabled:!i.trim()||"uploading"===u.status||"processing"===u.status,className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Fetch Document"})]}),"idle"!==u.status&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:["uploading"===u.status||"processing"===u.status?(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}):"success"===u.status?(0,s.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):(0,s.jsx)("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,s.jsx)("span",{className:"text-sm font-medium ".concat("success"===u.status?"text-green-600":"error"===u.status?"text-red-600":"text-foreground"),children:u.message})]}),("uploading"===u.status||"processing"===u.status)&&(0,s.jsx)("div",{className:"w-full bg-muted rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:"".concat(u.progress,"%")}})})]})]})}},2704:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var s=r(5155),o=r(2115),a=r(63);function n(e){let{id:t,name:r,file_size_bytes:n,created_at:i}=e,d=(0,a.useRouter)(),[l,c]=(0,o.useState)(!1),[u,m]=(0,o.useState)(!1),h=async()=>{try{c(!0);let e=await fetch("/api/documents?id=".concat(t),{method:"DELETE"}),r=await e.json();if(!e.ok)throw Error(r.message||"Delete failed");d.refresh()}catch(e){console.error("Delete error:",e),alert(e instanceof Error?e.message:"Failed to delete document"),c(!1),m(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-card border border-border rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:"pdf"===r.toLowerCase().split(".").pop()?(0,s.jsxs)("svg",{className:"w-8 h-8 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,s.jsx)("path",{d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"}),(0,s.jsx)("text",{x:"50%",y:"55%",fontSize:"6",fill:"white",textAnchor:"middle",dominantBaseline:"middle",children:"PDF"})]}):(0,s.jsxs)("svg",{className:"w-8 h-8 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,s.jsx)("path",{d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"}),(0,s.jsx)("text",{x:"50%",y:"55%",fontSize:"6",fill:"white",textAnchor:"middle",dominantBaseline:"middle",children:"TXT"})]})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-foreground truncate",title:r,children:r}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-xs text-muted-foreground",children:[(0,s.jsx)("span",{children:n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":(n/1048576).toFixed(1)+" MB"}),(0,s.jsx)("span",{children:"â€¢"}),(0,s.jsx)("span",{children:(e=>{let t=new Date(e),r=new Date().getTime()-t.getTime(),s=Math.floor(r/6e4),o=Math.floor(r/36e5),a=Math.floor(r/864e5);return s<1?"Just now":s<60?"".concat(s," minute").concat(s>1?"s":""," ago"):o<24?"".concat(o," hour").concat(o>1?"s":""," ago"):a<7?"".concat(a," day").concat(a>1?"s":""," ago"):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})(i)})]})]}),(0,s.jsx)("button",{onClick:()=>m(!0),disabled:l,className:"flex-shrink-0 p-2 text-muted-foreground hover:text-red-600 hover:bg-red-50 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete document",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})}),u&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,s.jsxs)("div",{className:"bg-card border border-border rounded-lg p-6 max-w-md w-full shadow-xl",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Delete Document?"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mb-6",children:["Are you sure you want to delete ",(0,s.jsx)("strong",{children:r}),"? This action cannot be undone and all associated data will be permanently removed."]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{onClick:()=>m(!1),disabled:l,className:"px-4 py-2 border border-border rounded-md hover:bg-accent transition-colors disabled:opacity-50",children:"Cancel"}),(0,s.jsxs)("button",{onClick:h,disabled:l,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:[l&&(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),l?"Deleting...":"Delete"]})]})]})})]})}function i(){let[e,t]=(0,o.useState)([]),[r,a]=(0,o.useState)([]),[i,d]=(0,o.useState)(!0),[l,c]=(0,o.useState)(null),[u,m]=(0,o.useState)(""),[h,p]=(0,o.useState)("date-desc"),x=async()=>{try{d(!0),c(null);let e=await fetch("/api/documents"),r=await e.json();if(!e.ok)throw Error(r.message||"Failed to fetch documents");t(r.documents||[]),a(r.documents||[])}catch(e){c(e instanceof Error?e.message:"Failed to load documents")}finally{d(!1)}};return(0,o.useEffect)(()=>{x()},[]),(0,o.useEffect)(()=>{let t=[...e];if(u.trim()){let e=u.toLowerCase();t=t.filter(t=>t.name.toLowerCase().includes(e))}t.sort((e,t)=>{switch(h){case"date-desc":return new Date(t.created_at).getTime()-new Date(e.created_at).getTime();case"date-asc":return new Date(e.created_at).getTime()-new Date(t.created_at).getTime();case"name-asc":return e.name.localeCompare(t.name);case"name-desc":return t.name.localeCompare(e.name);case"size-desc":return t.file_size_bytes-e.file_size_bytes;case"size-asc":return e.file_size_bytes-t.file_size_bytes;default:return 0}}),a(t)},[e,u,h]),(0,s.jsxs)("div",{className:"bg-card border border-border rounded-lg p-6 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Your Documents"}),(0,s.jsx)("button",{onClick:x,disabled:i,className:"p-2 text-muted-foreground hover:text-foreground hover:bg-accent rounded transition-colors disabled:opacity-50",title:"Refresh",children:(0,s.jsx)("svg",{className:"w-5 h-5 ".concat(i?"animate-spin":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"Search documents...",className:"w-full px-4 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-background"})}),(0,s.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"px-4 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-background",children:[(0,s.jsx)("option",{value:"date-desc",children:"Newest first"}),(0,s.jsx)("option",{value:"date-asc",children:"Oldest first"}),(0,s.jsx)("option",{value:"name-asc",children:"Name (A-Z)"}),(0,s.jsx)("option",{value:"name-desc",children:"Name (Z-A)"}),(0,s.jsx)("option",{value:"size-desc",children:"Largest first"}),(0,s.jsx)("option",{value:"size-asc",children:"Smallest first"})]})]}),i&&(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent mb-4"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading documents..."})]}),l&&!i&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("svg",{className:"w-12 h-12 text-red-500 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("p",{className:"text-sm text-red-600 mb-4",children:l}),(0,s.jsx)("button",{onClick:x,className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:"Try Again"})]}),!i&&!l&&0===r.length&&!u&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("svg",{className:"w-12 h-12 text-muted-foreground mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"No documents yet"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Upload your first document to get started"})]}),!i&&!l&&0===r.length&&u&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("svg",{className:"w-12 h-12 text-muted-foreground mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"No documents found"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Try a different search term"})]}),!i&&!l&&r.length>0&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mb-4",children:["Showing ",r.length," of ",e.length," document",1!==e.length?"s":""]}),r.map(e=>(0,s.jsx)(n,{id:e.id,name:e.name,file_size_bytes:e.file_size_bytes,created_at:e.created_at},e.id))]})]})}},9863:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2619,23)),Promise.resolve().then(r.bind(r,2704)),Promise.resolve().then(r.bind(r,1235))}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=9863)),_N_E=e.O()}]);