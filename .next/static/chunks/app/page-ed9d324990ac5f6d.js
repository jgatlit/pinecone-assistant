(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{97:(e,r,s)=>{Promise.resolve().then(s.bind(s,6868))},6868:(e,r,s)=>{"use strict";s.d(r,{default:()=>u});var a=s(5155),t=s(2115),l=s(688),n=s(926);let o=(0,n.createServerReference)("003c4a1b0a1991621fbb4425604bc4b63c56cfe1dd",n.callServer,void 0,n.findSourceMapURL,"getOrCreateSession"),i=(0,n.createServerReference)("40830fe467d98f626f09e505bb6a5035b589370368",n.callServer,void 0,n.findSourceMapURL,"loadMessageHistory"),c=(0,n.createServerReference)("782448f88f5a5a36cd22a77ada9800272fc92a406e",n.callServer,void 0,n.findSourceMapURL,"saveMessage"),d=(0,n.createServerReference)("7ff81018bcd743ace080b328c1b076f8eb6ebb9277",n.callServer,void 0,n.findSourceMapURL,"chat");var m=s(856);function x(e){let{files:r,referencedFiles:s}=e,[l,n]=(0,t.useState)(!0),o=e=>s.some(r=>e.name.toLowerCase().includes(r.name.toLowerCase())||r.name.toLowerCase().includes(e.name.toLowerCase()));return(0,a.jsxs)("div",{className:"w-full mt-4 bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden",children:[(0,a.jsxs)("button",{className:"w-full flex justify-between items-center p-4 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",onClick:()=>n(!l),children:[(0,a.jsx)("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:"Assistant Files"}),(0,a.jsx)("span",{className:"text-xl text-gray-600 dark:text-gray-300",children:l?"▲":"▼"})]}),l&&(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)("div",{className:"flex flex-wrap -mx-2",children:r.map(e=>(0,a.jsx)("div",{className:"w-full sm:w-1/2 md:w-1/3 px-2 mb-4 relative",children:(0,a.jsxs)("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-lg ".concat(o(e)?"border-2 border-blue-500 dark:border-blue-400":""),children:[(0,a.jsx)("h3",{className:"font-semibold truncate text-gray-800 dark:text-gray-200",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Size: ",(e=>{if(0===e)return"0 Byte";let r=parseInt(Math.floor(Math.log(e)/Math.log(1024)).toString());return Math.round(e/Math.pow(1024,r))+" "+["Bytes","KB","MB","GB","TB"][r]})(e.file_size_bytes)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Created: ",new Date(e.created_at).toLocaleDateString()]}),o(e)&&(0,a.jsx)("span",{className:"absolute top-2 right-2 bg-blue-500 dark:bg-blue-400 text-white text-xs px-2 py-1 rounded",children:"Referenced"})]})},e.id))})})]})}var h=s(1929);function u(e){let{initialShowAssistantFiles:r,showCitations:s}=e,[n,u]=(0,t.useState)(!0),[g,f]=(0,t.useState)(!1),[b,p]=(0,t.useState)(""),[v,j]=(0,t.useState)(""),[w]=(0,t.useState)("SBWC Chatbot"),[y,N]=(0,t.useState)([]),[k,S]=(0,t.useState)(r),M=(0,t.useRef)(null),[C,L]=(0,t.useState)([]),[z,D]=(0,t.useState)(!1),[E,R]=(0,t.useState)([]),[B,_]=(0,t.useState)(!1),[I,V]=(0,t.useState)(null),[A,F]=(0,t.useState)(!0);(0,t.useEffect)(()=>{{let e="true"===localStorage.getItem("darkMode");_(e),e&&document.documentElement.classList.add("dark")}},[]),(0,t.useEffect)(()=>{W(),O()},[]),(0,t.useEffect)(()=>{(async()=>{try{F(!0);let e=await o();if(!e){p("Failed to create chat session. Please ensure you are logged in."),F(!1);return}V(e);let r=await i(e);L(r)}catch(e){console.error("Error initializing session:",e),p("Failed to load chat history")}finally{F(!1)}})()},[]);let O=async()=>{try{let e=await fetch("/api/documents"),r=await e.json();"success"===r.status?R(r.documents||[]):console.error("Error fetching documents:",r.message)}catch(e){console.error("Error fetching documents:",e)}},W=async()=>{try{let e=await fetch("/api/health"),r=await e.json();u(!1),f("healthy"===r.status),"healthy"!==r.status&&p("Chatbot system is currently unavailable")}catch(e){u(!1),p("Error connecting to the chatbot system")}},U=async()=>{if(!v.trim())return;if(!I){console.error("No session ID available"),p("Session not initialized. Please refresh the page.");return}let e={id:(0,h.A)(),role:"user",content:v,timestamp:new Date().toISOString()};L(r=>[...r,e]),j(""),D(!0),c(I,"user",e.content).catch(e=>{console.error("Failed to save user message:",e)});try{let r=[...C.map(e=>({role:e.role,content:e.content})),{role:"user",content:e.content}],{object:s,citations:a}=await d(r),t="",n={id:(0,h.A)(),role:"assistant",content:"",timestamp:new Date().toISOString(),references:[]};for await(let e of(L(e=>[...e,n]),(0,l.S7)(s)))e&&(t+=e,L(e=>{let r=[...e];return r[r.length-1].content=t,r}));let o=(null==a?void 0:a.map(e=>({name:e.name,url:e.url,documentId:e.documentId,relevance:e.relevance,error:e.error})))||[];L(e=>{let r=[...e];return r[r.length-1].references=o,r}),c(I,"assistant",t,o).catch(e=>{console.error("Failed to save assistant message:",e)});let i=(e=>{let r=[],s=e.match(/([^:\n]+\.[a-zA-Z0-9]+)/g);return s&&s.forEach(e=>{r.push({name:e.trim()})}),r})(t);N(i)}catch(e){console.error("Error in chat:",e),p("An error occurred while chatting.")}finally{D(!1)}};return(0,a.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 sm:p-8 bg-gray-50 dark:bg-gray-900",children:[(0,a.jsxs)("div",{className:"absolute top-4 right-4 flex gap-2",children:[(0,a.jsx)("a",{href:"/documents",className:"p-2 rounded-full bg-indigo-500 hover:bg-indigo-600 text-white shadow-lg transition-colors","aria-label":"Manage Documents",title:"Upload and manage documents",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsx)("button",{onClick:()=>{_(!B),localStorage.setItem("darkMode",(!B).toString()),document.documentElement.classList.toggle("dark")},className:"p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200","aria-label":B?"Switch to light mode":"Switch to dark mode",children:B?(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})})]}),n?(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-900 mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Connecting to the chatbot..."})]}):g?(0,a.jsxs)("div",{className:"w-full max-w-6xl xl:max-w-7xl",children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold mb-4 text-indigo-900 dark:text-indigo-100",children:[w," ",(0,a.jsx)("span",{className:"text-green-500",children:"●"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg mb-4 h-[calc(100vh-500px)] overflow-y-auto",children:[A?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Loading chat history..."})]})}):C.map((e,r)=>(0,a.jsx)("div",{className:"mb-2 flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex items-start ".concat("user"===e.role?"flex-row-reverse":"flex-row"),children:[(0,a.jsx)("div",{className:"".concat("user"===e.role?"ml-2":"mr-2"),children:"user"===e.role?(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC64"}):(0,a.jsx)("span",{className:"text-2xl",children:"\uD83E\uDD16"})}),(0,a.jsxs)("span",{className:"inline-block p-2 rounded-lg ".concat("user"===e.role?"bg-indigo-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"," max-w-[80%] break-words"),children:[(0,a.jsx)(m.oz,{components:{a:e=>{let{node:r,...s}=e;return(0,a.jsxs)("a",{...s,className:"text-blue-600 dark:text-blue-400 hover:underline",children:["\uD83D\uDD17 ",s.children]})}},children:e.content}),e.references&&e.references.length>0&&s&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-300 dark:border-gray-600",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Sources:"}),(0,a.jsx)("ul",{className:"space-y-1.5",children:e.references.map((e,r)=>(0,a.jsx)("li",{className:"text-sm",children:(0,a.jsxs)("div",{className:"flex items-start gap-1.5",children:[e.url?(0,a.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline inline-flex items-center gap-1.5 flex-1","aria-label":"Open source document: ".concat(e.name),children:[(0,a.jsx)("svg",{className:"w-4 h-4 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("span",{className:"break-all",children:e.name})]}):(0,a.jsxs)("span",{className:"text-gray-500 dark:text-gray-400 inline-flex items-center gap-1.5 flex-1",children:[(0,a.jsx)("svg",{className:"w-4 h-4 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsxs)("span",{className:"break-all",children:[e.name,e.error&&(0,a.jsxs)("span",{className:"text-xs ml-1",children:["(",e.error,")"]})]})]}),e.relevance&&(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-auto flex-shrink-0 mt-0.5",children:e.relevance})]})},r))})]})]})]})},r)),(0,a.jsx)("div",{ref:M})]}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),U()},className:"flex mb-4",children:[(0,a.jsx)("input",{type:"text",value:v,onChange:e=>j(e.target.value),className:"flex-grow p-2 text-black border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Type your message...",disabled:z}),(0,a.jsx)("button",{type:"submit",className:"bg-indigo-500 text-white p-2 rounded-r-lg hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:z,children:z?"Streaming...":"Send"})]}),b&&(0,a.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md shadow-md",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("svg",{className:"h-6 w-6 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,a.jsx)("p",{className:"font-semibold",children:"Error"})]}),(0,a.jsx)("p",{className:"mt-2",children:b})]})]}),k&&(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(x,{files:E,referencedFiles:y})})]})]}):(0,a.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md max-w-2xl",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("svg",{className:"h-6 w-6 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,a.jsx)("p",{className:"font-semibold",children:"Error"})]}),(0,a.jsx)("p",{className:"mt-2",children:b}),(0,a.jsxs)("div",{className:"mt-4 text-sm",children:[(0,a.jsx)("p",{className:"font-semibold",children:"To resolve this issue:"}),(0,a.jsxs)("ol",{className:"list-decimal list-inside mt-2 space-y-2",children:[(0,a.jsx)("li",{children:"Verify database connection is configured"}),(0,a.jsx)("li",{children:"Check that required environment variables are set"}),(0,a.jsx)("li",{children:"Restart the application"})]})]})]})]})}}},e=>{e.O(0,[896,441,255,358],()=>e(e.s=97)),_N_E=e.O()}]);