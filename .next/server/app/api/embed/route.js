"use strict";(()=>{var e={};e.id=556,e.ids=[556],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},29842:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>c,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>u,maxDuration:()=>d});var n=r(49303),i=r(88716),o=r(60670),a=r(87070),m=r(92992);let d=30;async function u(e){try{let{text:t}=await e.json();if(!t||"string"!=typeof t)return a.NextResponse.json({status:"error",message:"Text is required and must be a string"},{status:400});let r=t.trim();if(0===r.length)return a.NextResponse.json({status:"error",message:"Text cannot be empty"},{status:400});if(r.length>8e3)return a.NextResponse.json({status:"error",message:"Text too long. Maximum length: 8000 characters"},{status:400});let s=await (0,m.C6)(r);return a.NextResponse.json({status:"success",embedding:s,dimensions:s.length,model:"text-embedding-3-small"},{status:200})}catch(e){return console.error("Embedding generation error:",e),a.NextResponse.json({status:"error",message:e instanceof Error?e.message:"Embedding generation failed"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/embed/route",pathname:"/api/embed",filename:"route",bundlePath:"app/api/embed/route"},resolvedPagePath:"/home/jgatlit/projects/BourneLaw/SBWC-chatbot/pinecone-assistant/src/app/api/embed/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:c}=l,x="/api/embed/route";function h(){return(0,o.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:g})}},92992:(e,t,r)=>{r.d(t,{C6:()=>a,VI:()=>d,nj:()=>m});var s=r(54214);let n=null;function i(){if(!n){let e=process.env.OPENAI_API_KEY;if(!e)throw Error("Missing OPENAI_API_KEY environment variable");n=new s.ZP({apiKey:e})}return n}let o={model:"text-embedding-3-large",dimensions:1536,maxRetries:3,retryDelayMs:1e3};async function a(e){let t=e.trim();if(!t)throw Error("Cannot generate embedding for empty text");let r=i(),s=null;for(let e=1;e<=o.maxRetries;e++)try{let e=await r.embeddings.create({model:o.model,input:t,dimensions:o.dimensions}),s=e.data[0]?.embedding;if(!s)throw Error("No embedding returned from OpenAI API");if(s.length!==o.dimensions)throw Error(`Expected ${o.dimensions} dimensions, got ${s.length}`);return s}catch(t){if((s=t instanceof Error?t:Error(String(t))).message.includes("empty text")||s.message.includes("dimensions"))throw s;if(e<o.maxRetries){let t=o.retryDelayMs*Math.pow(2,e-1);console.warn(`Embedding generation failed (attempt ${e}/${o.maxRetries}), retrying in ${t}ms...`,s.message),await new Promise(e=>setTimeout(e,t))}}throw Error(`Failed to generate embedding after ${o.maxRetries} attempts: ${s?.message}`)}async function m(e,t=100){if(0===e.length)return[];let r=[],s=i();for(let n=0;n<e.length;n+=t){let i=e.slice(n,n+t),a=null;for(let e=1;e<=o.maxRetries;e++)try{let e=(await s.embeddings.create({model:o.model,input:i,dimensions:o.dimensions})).data.sort((e,t)=>e.index-t.index).map(e=>e.embedding);r.push(...e);break}catch(t){if(a=t instanceof Error?t:Error(String(t)),e<o.maxRetries){let t=o.retryDelayMs*Math.pow(2,e-1);console.warn(`Batch embedding generation failed (attempt ${e}/${o.maxRetries}), retrying in ${t}ms...`,a.message),await new Promise(e=>setTimeout(e,t))}else throw Error(`Failed to generate batch embeddings after ${o.maxRetries} attempts: ${a.message}`)}}return r}function d(e){return Math.ceil(e.length/4)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,326,214],()=>r(29842));module.exports=s})();